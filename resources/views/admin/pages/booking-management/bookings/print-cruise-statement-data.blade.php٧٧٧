<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>{{ $title }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            padding: 20px;
            box-sizing: border-box;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .main {
            display: block;
            direction: ltr;
        }

        .column {
            width: 100%;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            margin-bottom: 20px;
        }

        th,
        td {
            border: 1px solid #000;
            padding: 6px;
            text-align: center;
        }

        .service-table {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }

        .service-header {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .bold-row {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="title">{{ $title }}</div>
        <div class="subtitle">{{ __('Generated by') }}: {{ $username }}</div>
        <div class="subtitle">{{ __('Date') }}: {{ now()->format('Y-m-d H:i') }}</div>
    </div>

    <div style="text-align: center; margin-bottom: 20px;">
        <span><strong>{{ __('Booking Date') }}</strong>: {{ $data['booking']->booking_date->format('Y-m-d') }}</span>
        <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
        <span><strong>{{ __('Boat Name') }}</strong>: {{ $data['booking']->sailing_boat->name }}</span>
        <br>
        <span><strong>{{ __('Booking Type') }}</strong>:
            {{ $data['booking']->type->name . ' - ' . __($data['booking']->booking_type) . ' - ' . $data['booking']->branch->name . ' ( ' . $data['booking']->start_time->format('H:i') . ' )' }}</span>
        <br>
        <span><strong>{{ __('Price Person / Hour') }}</strong>:
            @foreach ($data['booking']->booking_groups as $group)
                {{ $group->hour_member_price }}{{ $group->currency_symbol }}
                @if (!$loop->last)
                    ,
                @endif
            @endforeach
        </span>
    </div>

    <div class="main">
        <div class="column">
            <table>
                <thead>
                    <tr class="service-header">
                        <td colspan="2">{{ __('Cruise Statements') }}</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ __('Total Members') }}</td>
                        <td>{{ $data['booking']->total_members }}</td>
                    </tr>
                    @foreach ($data['aggregatedClientTypes'] as $clientType)
                        <tr>
                            <td>{{ $clientType['name'] }}</td>
                            <td>{{ $clientType['count'] }}</td>
                        </tr>
                    @endforeach
                    <tr class="bold-row">
                        <td>{{ __('Total') }}</td>
                        <td>
                            @foreach ($data['currencyTotals'] as $currency)
                                {{ number_format($currency['price'], 2) }}{{ $currency['symbol'] }}<br>
                            @endforeach
                        </td>
                    </tr>
                    <tr class="bold-row">
                        <td>{{ __('Discounted') }}</td>
                        <td>
                            @foreach ($data['currencyTotals'] as $currency)
                                {{ number_format($currency['discount'], 2) }}{{ $currency['symbol'] }}<br>
                            @endforeach
                        </td>
                    </tr>
                    <tr class="bold-row">
                        <td>{{ __('Paid') }}</td>
                        <td>
                            @foreach ($data['currencyTotals'] as $currency)
                                {{ number_format($currency['paid'], 2) }}{{ $currency['symbol'] }}<br>
                            @endforeach
                        </td>
                    </tr>
                    @foreach ($data['paymentMethodTotals'] as $methodId => $method)
                        <tr>
                            <td>{{ $method['name'] }}</td>
                            <td>
                                @foreach ($data['paymentMethodByCurrency'] as $currencyData)
                                    @isset($currencyData['methods'][$methodId])
                                        {{ number_format($currencyData['methods'][$methodId]['total'], 2) }}{{ $currencyData['symbol'] }}<br>
                                    @endisset
                                @endforeach
                            </td>
                        </tr>
                    @endforeach
                </tbody>
            </table>
        </div>

        <div class="column">
            @foreach ($data['servicesWithParents'] as $parentData)
                <div class="service-table">
                    <table>
                        <tr class="service-header">
                            <td colspan="2">{{ $parentData['parent_name'] }}</td>
                        </tr>
                        @foreach ($parentData['services'] as $serviceName => $count)
                            <tr>
                                <td>{{ $serviceName }}</td>
                                <td>{{ $count }}</td>
                            </tr>
                        @endforeach
                        <tr class="bold-row">
                            <td>{{ __('Total Paid') }}</td>
                            <td>
                                @foreach ($parentData['currencies'] as $currency)
                                    {{ number_format($currency['paid'], 2) }}{{ $currency['symbol'] }}<br>
                                @endforeach
                            </td>
                        </tr>
                        @foreach ($parentData['payment_methods'] as $methodId => $method)
                            <tr>
                                <td>{{ $method['name'] }}</td>
                                <td>
                                    @foreach ($method['amounts'] as $currency)
                                        {{ number_format($currency['amount'], 2) }}{{ $currency['symbol'] }}<br>
                                    @endforeach
                                </td>
                            </tr>
                        @endforeach
                    </table>
                </div>
            @endforeach

            @foreach ($data['servicesWithoutParents'] as $serviceName => $serviceData)
                <div class="service-table">
                    <table>
                        <tr class="service-header">
                            <td colspan="2">{{ $serviceName }}</td>
                        </tr>
                        <tr>
                            <td>{{ __('Total Count') }}</td>
                            <td>{{ $serviceData['total_count'] }}</td>
                        </tr>
                        <tr>
                            <td>{{ __('Unit Price') }}</td>
                            <td>
                                @foreach ($serviceData['currencies'] as $currency)
                                    {{ number_format($currency['unit_price'], 2) }}{{ $currency['symbol'] }}<br>
                                @endforeach
                            </td>
                        </tr>
                        <tr>
                            <td>{{ __('Paid') }}</td>
                            <td>
                                @foreach ($serviceData['currencies'] as $currency)
                                    {{ number_format($currency['paid'], 2) }}{{ $currency['symbol'] }}<br>
                                @endforeach
                            </td>
                        </tr>
                        @foreach ($serviceData['payment_methods'] as $methodId => $method)
                            <tr>
                                <td>{{ $method['name'] }}</td>
                                <td>
                                    @foreach ($method['amounts'] as $currency)
                                        {{ number_format($currency['amount'], 2) }}{{ $currency['symbol'] }}<br>
                                    @endforeach
                                </td>
                            </tr>
                        @endforeach
                    </table>
                </div>
            @endforeach
        </div>

        <div class="column">
            <table>
                <tbody>
                    <tr>
                        <td>{{ __('Total') }}</td>
                        <td>
                            @foreach ($data['combinedTotals'] as $currency)
                                {{ number_format($currency['total'], 2) }}{{ $currency['symbol'] }}<br>
                            @endforeach
                        </td>
                    </tr>

                    @foreach ($data['combinedPaymentMethods'] as $methodId => $method)
                        <tr>
                            <td>{{ $method['name'] }}</td>
                            <td>
                                @foreach ($method['amounts'] as $currencyId => $amount)
                                    {{ number_format($amount['amount'], 2) }}{{ $amount['symbol'] }}<br>
                                @endforeach
                            </td>
                        </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>
